-- UniScript BETA Full Features Wiring f fds
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")

-- get Humanoid / Character references
local Character, Humanoid, RootPart
local function getHumanoid()
    Character = LocalPlayer.Character
    if Character then
        Humanoid = Character:FindFirstChildWhichIsA("Humanoid")
        RootPart = Character:FindFirstChild("HumanoidRootPart")
    end
end
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    getHumanoid()
end)
getHumanoid()

-- =========================
-- Infinite Sprint
-- =========================
task.spawn(function()
    while task.wait(0.1) do
        if Settings.InfiniteSprint and Humanoid then
            for _,tbl in pairs(getgc(true)) do
                if type(tbl)=="table" and rawget(tbl,"S") then
                    rawset(tbl,"S",100)
                end
            end
        end
    end
end)

-- =========================
-- Player FOV updater
-- =========================
RunService.RenderStepped:Connect(function()
    if Camera then Camera.FieldOfView = Settings.PlayerFOV end
end)

-- =========================
-- NoClip
-- =========================
RunService.Stepped:Connect(function()
    if Settings.NoClipEnabled and Character then
        for _, part in pairs(Character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

-- =========================
-- ESP
-- =========================
local ESPBoxes = {}
local function createESP(player)
    if player == LocalPlayer then return end
    local box = Drawing.new("Square")
    box.Color = Color3.fromRGB(0,255,0)
    box.Thickness = 2
    box.Filled = false
    box.Transparency = 1
    ESPBoxes[player] = box
end
local function removeESP(player)
    if ESPBoxes[player] then
        ESPBoxes[player]:Remove()
        ESPBoxes[player] = nil
    end
end
Players.PlayerAdded:Connect(createESP)
Players.PlayerRemoving:Connect(removeESP)
for _,p in pairs(Players:GetPlayers()) do createESP(p) end

RunService.RenderStepped:Connect(function()
    for player,box in pairs(ESPBoxes) do
        if Settings.ESPEnabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local pos, vis = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if vis then
                box.Visible = true
                box.Size = Vector2.new(30,60)
                box.Position = Vector2.new(pos.X-15,pos.Y-30)
            else
                box.Visible = false
            end
        else
            box.Visible = false
        end
    end
end)

-- =========================
-- Aimlock
-- =========================
local Circle = Drawing.new("Circle")
Circle.Radius = Settings.AimlockFOV
Circle.Color = Color3.fromRGB(255,0,0)
Circle.Thickness = 1
Circle.Visible = false
Circle.Filled = false

RunService.RenderStepped:Connect(function()
    Circle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    Circle.Radius = Settings.AimlockFOV
    Circle.Visible = Settings.AimlockEnabled
end)

local function getClosestTarget()
    local closest, dist = nil, math.huge
    for _,player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local pos, vis = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if vis then
                local d = (Vector2.new(pos.X,pos.Y)-Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                if d < Circle.Radius and d < dist then
                    closest, dist = player, d
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if Settings.AimlockEnabled then
        local target = getClosestTarget()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local headPos = target.Character.Head.Position
            local aimPos = headPos + (target.Character.HumanoidRootPart.Velocity * Settings.AimlockPrediction)
            Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, aimPos)
        end
    end
end)

-- =========================
-- Wallbang (simplified)
-- =========================
RunService.RenderStepped:Connect(function()
    if Settings.WallbangEnabled then
        -- your shooting hook should ignore walls here
        -- e.g. raycast params ignore workspace geometry
    end
end)

-- =========================
-- Melee Aura / Reach
-- =========================
RunService.RenderStepped:Connect(function()
    if Settings.MeleeAuraEnabled and Character and RootPart then
        for _,player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChildWhichIsA("Humanoid") then
                local hrp = player.Character.HumanoidRootPart
                local dist = (hrp.Position - RootPart.Position).Magnitude
                if dist <= Settings.MeleeReach then
                    -- apply melee damage here
                    -- Example: player.Character.Humanoid:TakeDamage(10)
                end
            end
        end
    end
end)

print("âœ… UniScript BETA: All features wired (Aimlock, ESP, Wallbang, Melee Aura, Sprint, NoClip, Player FOV)")
